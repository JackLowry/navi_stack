<?xml version="1.0"?>
<robot xmlns:body="http://playerstage.sourceforge.net/gazebo/xmlschema/#body" 
       xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
       xmlns:geom="http://playerstage.sourceforge.net/gazebo/xmlschema/#geom" 
       xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface" 
       xmlns:joint="http://playerstage.sourceforge.net/gazebo/xmlschema/#slider" 
       xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor" 
       xmlns:xacro="http://ros.org/wiki/xacro">
	<property name="M_PI" value="3.1415926535897931" />
	<property name="wheel_radius" value="0.127"/>
	<property name="wheel_length" value="0.1524"/>
	<property name="wheel_offset_y" value="0.35433"/>
	<property name="wheel_offset_x" value="0.3596132"/>
	<property name="caster_wheel_radius" value="0.108"/>


<xacro:macro name="diffdrive" params="prefix">
	        <gazebo>
	         <controller:diffdrive_plugin name="differential_drive_controller" plugin="libdiffdrive_plugin.so">
                <alwaysOn>true</alwaysOn>
                <update>100</update>
                <updateRate>100.0</updateRate>
                <leftJoint>${prefix}l_wheel_joint</leftJoint>
                <rightJoint>${prefix}r_wheel_joint</rightJoint>
                <wheelSeparation>${wheel_offset_y*2}</wheelSeparation>
                <wheelDiameter>${wheel_radius*2}</wheelDiameter>
                <torque>1000</torque>
                <interface:position name="position_iface_${prefix}"/>
                <robotNamespace>/</robotNamespace>
                <topicName>/drive/cmd_vel</topicName>
            </controller:diffdrive_plugin>
            </gazebo>
</xacro:macro>

	<xacro:macro name="wheel" params="prefix reflect_x reflect_y">
		<joint name="${prefix}_wheel_asm_joint" type="fixed">
			<axis xyz="0 1 0"/>
			<origin xyz="${reflect_x * wheel_offset_x} ${reflect_y * wheel_offset_y} -0.358775" rpy="0 0 0"/>
			<parent link="base_link"/>
			<child link="${prefix}_wheel_asm_link"/>
		</joint>

		<link name="${prefix}_wheel_asm_link">
			<inertial>
				<mass value="1.26796185"/>
				<origin xyz="0 0 0"/>
				<inertia ixx="0.012411765597" ixy="0.0" ixz="0.0"
						 iyy="0.015218160428" iyz="0.0" izz="0.011763977943"/>
			</inertial>
			<visual>
				<origin xyz="0 0 0" rpy="0 0 ${reflect_y*M_PI/2 -M_PI/2}" />
				<geometry>
					<mesh filename="package://navi_model/meshes/wheel.stl" />
				</geometry>
				<material name="Grey" />
			</visual>

				
		</link>
		
		<joint name="${prefix}_wheel_joint" type="continuous">
			<axis xyz="0 1 0"/>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<parent link="${prefix}_wheel_asm_link"/>
			<child link="${prefix}_wheel_link"/>
		</joint>

		<link name="${prefix}_wheel_link">
			<inertial>
				<mass value="1"/>
				<origin xyz="0 0 0"/>
				<inertia ixx="0.012411765597" ixy="0.0" ixz="0.0"
						 iyy="0.015218160428" iyz="0.0" izz="0.011763977943"/>
			</inertial>
			<visual>
				<origin xyz="0 0 0" rpy="${M_PI/2} 0 0" />
				<geometry>
					<cylinder radius="${wheel_radius}" length="${wheel_length}" />
				</geometry>
				<material name="Grey" />
			</visual>
			<collision>
				<!-- rotation because cyl. geom primitive has symmetry axis in +x direction -->
				<origin xyz="0 0 0" rpy="${M_PI/2} 0 0 " />
				<geometry>
					<cylinder radius="${wheel_radius}" length="${wheel_length-0.5}" />
				</geometry>
			</collision>
		</link>
		
		  <gazebo reference="${prefix}_wheel_link" >
            <mu1 value="100.0" />
            <mu2 value="100.0" />
            <kp  value="1000000.0" />
            <kd  value="1.0" />
            <material>Erratic/Grey</material>
        </gazebo>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="${prefix}_wheel_trans">
            <actuator name="${prefix}_wheel_motor" />
            <joint name="${prefix}_wheel_joint" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>
        
	</xacro:macro>
	
	
<xacro:macro name="caster" params="">
	<joint name="caster_base_joint" type="fixed">
		<origin xyz="-0.38967 0 -0.250825" rpy="0 0 0"/>
		<parent link="base_link"/>
		<child link="caster_base_link"/>
	</joint>
	
	<link name="caster_base_link">
		<inertial>
				<mass value="0.1"/>
				<origin xyz="0 0 0"/>
				<inertia ixx="0.012411765597" ixy="0.0" ixz="0.0"
						 iyy="0.015218160428" iyz="0.0" izz="0.011763977943"/>
			</inertial>
			<visual>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry>
					<box size="0.1 0.1 .03"  />
				</geometry>
				<material name="Grey" />
			</visual>
			<collision>
				<!-- rotation because cyl. geom primitive has symmetry axis in +x direction -->
				<origin xyz="0 0 0" rpy="0 0 0 " />
				<geometry>
					<box size="0.1 0.1 .03"  />
				</geometry>
			</collision>
	</link>
	
	
	<link name="caster_swivel_link">
			<inertial>
				<mass value="0.1"/>
				<origin xyz="0 0 0"/>
				<inertia ixx="0.012411765597" ixy="0.0" ixz="0.0"
						 iyy="0.015218160428" iyz="0.0" izz="0.011763977943"/>
			</inertial>
			<visual>
				<origin xyz="0 0 0" rpy="0 90 0" />
				<geometry>
					<cylinder radius="0.1" length="0.05"/>
				</geometry>
				<material name="Grey" />
			</visual>
			<collision>
				<!-- rotation because cyl. geom primitive has symmetry axis in +x direction -->
				<origin xyz="0 0 0" rpy="0 90 0 " />
				<geometry>
					<cylinder radius="0.1" length="0.05"/>
				</geometry>
			</collision>
	</link>
	
	<joint name="caster_swivel_joint" type="continuous">
		<origin xyz="0 0 0" rpy="0 0 0"/>
		<axis xyz="0 0 1"/>
		<parent link="caster_base_link"/>
		<child link="caster_swivel_link"/>
	</joint>
	
	
	<joint name="caster_wheel_joint" type="continuous">
		<origin xyz="-0.0405 0 -0.122238" rpy="0 0 0"/>
		<axis xyz="0 1 0"/>
		<parent link="caster_swivel_link"/>
		<child link="caster_wheel_link"/>
	</joint>
	
	
	<link name="caster_wheel_link">
		<inertial>
			<mass value="1"/>
			<origin xyz="0 0 0"/>
			<inertia ixx="0.012411765597" ixy="0.0" ixz="0.0"
						 iyy="0.015218160428" iyz="0.0" izz="0.011763977943"/>
		</inertial>
		<visual>
			<origin xyz="0 0 0" rpy="${M_PI/2} 0 0" />
			<geometry>
				<cylinder radius="${caster_wheel_radius}" length="0.05" />
			</geometry>
			<material name="Grey" />
		</visual>
		<collision>
			<!-- rotation because cyl. geom primitive has symmetry axis in +x direction -->
			<origin xyz="0 0 0" rpy="${M_PI/2} 0 0 " />
			<geometry>
				<cylinder radius="${caster_wheel_radius}" length="0.05" />
			</geometry>
		</collision>

	</link>
	</xacro:macro>
</robot>
