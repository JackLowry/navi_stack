<launch>
	<!-- Static URDF -->
	<node pkg="joint_state_publisher" type="joint_state_publisher" name="joint_publisher"/>
	<node pkg="robot_state_publisher" type="state_publisher" name="state_publisher"/>
	<include file="$(find navi_model)/launch/model_upload.launch"/>

	<!-- Vision -->
	<group ns="vision">
		<node pkg="nodelet" type="nodelet" name="vision_manager" args="manager"/>

		<!-- Monocular Line Detection -->
		<node pkg="nodelet" type="nodelet" name="center_white_filter" args="load white_filter/white_nodelet vision_manager">
			<param name="use_low"  value="true"/>
			<param name="use_high" value="false"/>
			<param name="threshold_hue" value="180"/>
			<param name="threshold_sat" value="127"/>
			<remap from="image" to="narrow/left/image_rect_color"/>
			<remap from="white" to="center_white"/>
		</node>
		<node pkg="nodelet" type="nodelet" name="center_lined" args="load line_detection/line_nodelet vision_manager">
			<param name="thickness" value="0.0762"/>
			<param name="border"    value="0.1452"/>
			<param name="threshold" value="60"/>
			<param name="cutoff"    value="3"/>
			<param name="frame"     value="/base_footprint"/>
			<param name="debug"     value="false"/>
			<remap from="image"       to="center_white"/>
			<remap from="camera_info" to="narrow/left/camera_info"/>
			<remap from="line_points" to="center_line"/>
		</node>

		<node pkg="nodelet" type="nodelet" name="left_white_filter" args="load white_filter/white_nodelet vision_manager">
			<param name="use_low"  value="true"/>
			<param name="use_high" value="false"/>
			<param name="threshold_hue" value="180"/>
			<param name="threshold_sat" value="127"/>
			<remap from="image" to="wheel/left/image_raw"/>
			<remap from="white" to="left_white"/>
		</node>
		<node pkg="nodelet" type="nodelet" name="left_lined" args="load line_detection/line_nodelet vision_manager">
			<param name="thickness" value="0.0762"/>
			<param name="border"    value="0.1452"/>
			<param name="threshold" value="60"/>
			<param name="cutoff"    value="3"/>
			<param name="frame"     value="/base_footprint"/>
			<param name="debug"     value="false"/>
			<remap from="image"       to="left_white"/>
			<remap from="camera_info" to="wheel/left/camera_info"/>
			<remap from="line_points" to="left_line"/>
		</node>

		<node pkg="nodelet" type="nodelet" name="right_white_filter" args="load white_filter/white_nodelet vision_manager">
			<param name="use_low"  value="true"/>
			<param name="use_high" value="false"/>
			<param name="threshold_hue" value="180"/>
			<param name="threshold_sat" value="127"/>
			<remap from="image" to="wheel/right/image_raw"/>
			<remap from="white" to="right_white"/>
		</node>
		<node pkg="nodelet" type="nodelet" name="right_lined" args="load line_detection/line_nodelet vision_manager">
			<param name="thickness" value="0.0762"/>
			<param name="border"    value="0.1452"/>
			<param name="threshold" value="60"/>
			<param name="cutoff"    value="3"/>
			<param name="frame"     value="/base_footprint"/>
			<param name="debug"     value="false"/>
			<remap from="image"       to="right_white"/>
			<remap from="camera_info" to="wheel/right/camera_info"/>
			<remap from="line_points" to="right_line"/>
		</node>

		<node pkg="nodelet" type="nodelet" name="line_tracker" args="load line_tracking/tracker_node vision_manager">
			<param name="inputs" value="3"/>
			<remap from="points0" to="left_line"/>
			<remap from="points1" to="center_line"/>
			<remap from="points2" to="right_line"/>
		</node>

		<!-- Stereo Vision -->
		<node pkg="nodelet" type="nodelet" name="stereo_ground" args="load stereo_plane/ground_nodelet vision_manager">
			<param name="inliers_min"   value="150"/>
			<param name="range_max"     value="5.000"/>
			<param name="error_default" value="0.20"/>
			<param name="error_inlier"  value="0.05"/>
			<param name="error_angle"   value="0.523598776"/>
			<param name="frame_fixed"   value="/base_link"/>
			<param name="frame_default" value="/base_footprint"/>
			<remap from="points" to="narrow/points2"/>
		</node>
		<node pkg="stereo_od" type="od_node" name="stereo_od">
			<remap from="points"      to="narrow/points2"/>
			<remap from="camera_info" to="narrow/left/camera_info"/>
			<param name="points_min"   value="500"/>
			<param name="height_min"   value="0.5"/>
			<param name="height_max"   value="1.0"/>
			<param name="distance_max" value="1000"/>
			<param name="theta"        value="1.04719755"/>
		</node>
		<group ns="narrow">
			<node pkg="stereo_image_proc" type="stereo_image_proc" name="narrow_proc">
				<remap from="stereo" to="narrow"/>
				<remap from="image"  to="image_color"/>
				<remap from="left/image_raw"    to="left/image_raw"/>
				<remap from="right/image_raw"   to="right/image_raw"/>
				<remap from="left/camera_info"  to="left/camera_info"/>
				<remap from="right/camera_info" to="right/camera_info"/>
			</node>
		</group>
		<group ns="wide">
			<node pkg="stereo_image_proc" type="stereo_image_proc" name="wide_proc">
				<remap from="stereo" to="wide"/>
				<remap from="image"  to="image_color"/>
				<remap from="left/image_raw"    to="left/image_raw"/>
				<remap from="right/image_raw"   to="right/image_raw"/>
				<remap from="left/camera_info"  to="left/camera_info"/>
				<remap from="right/camera_info" to="right/camera_info"/>
			</node>
		</group>
	</group>
</launch>
